var assert = require('assert');
var equal = require('assert-dir-equal');

var Metalsmith = require('metalsmith');
var markdown = require('metalsmith-markdown');

var metalsmithLiquid = require('..');

describe('metalsmith-liquid', function(){

    it('should take data from global metadata and render accordingly', function (done) {
        Metalsmith('test/fixtures/metadata')
            .metadata({
                name: 'metalsmith-liquid',
                organization: 'npm'
            })
            .use(metalsmithLiquid({
                filters: {
                    upperCase: function (input) {
                        return input.toUpperCase();
                    }
                }
            }))
            .use(markdown())
            .build(function(err){
                if (err) {
                    done(err);
                    return
                }
                equal('test/fixtures/metadata/expected', 'test/fixtures/metadata/build');
                done();
            }); 
    });

    it('should take filters and render liquid inside markdown files', function(done) {
        Metalsmith('test/fixtures/filters')
            .use(metalsmithLiquid({
                filters: {
                    example: function (input) {
                        return '<div>' + input + '</div>';
                    },
                    other: function () {
                        return '<h1>Other Example</h1>';
                    }
                }
            }))
            .use(markdown())
            .build(function(err){
                if (err) {
                    done(err);
                    return
                }
                equal('test/fixtures/filters/expected', 'test/fixtures/filters/build');
                done();
            }); 
    });
});  
